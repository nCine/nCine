import org.apache.tools.ant.taskdefs.condition.Os

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:2.1.2'
    }
}

apply plugin: 'com.android.application'

android {

	def numCores = Runtime.runtime.availableProcessors()

	def ndkCommand = null
	if (Os.isFamily(Os.FAMILY_WINDOWS)) {
		ndkCommand = 'ndk-build.cmd'
	} else {
		ndkCommand = 'ndk-build'
	}

	compileSdkVersion @NCINE_COMPILESDK_VERSION@
	buildToolsVersion "24"

	defaultConfig {
		minSdkVersion @NCINE_MINSDK_VERSION@
		targetSdkVersion @NCINE_TARGETSDK_VERSION@
		versionCode 1
		versionName "@NCINE_VERSION@"
	}

	sourceSets.main {
		jniLibs.srcDir 'src/main/libs'
		jni.srcDirs = [] // disable automatic ndk-build call
	}

	task ndkBuild(type: Exec) {
		commandLine ndkCommand, '-C', file('src/main').absolutePath, '-j' + numCores
	}

	tasks.withType(JavaCompile) {
		compileTask -> compileTask.dependsOn ndkBuild
	}

	task ndkClean(type: Exec) {
		commandLine ndkCommand, '-C', file('src/main').absolutePath, 'clean'
	}

	clean.dependsOn 'ndkClean'
}
